{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h1>Detalhes da Conta Bancária</h1>

    <div class="card">
        <div class="card-header">
            Conta: {{ conta.nome }}
        </div>
        <div class="card-body">
            <h5 class="card-title"><strong>Saldo Atual:</strong> R$ {{ conta.saldo_atual }}</h5>
            <p class="card-text">Saldo Inicial: R$ {{ conta.saldo_inicial }}</p>
            <p class="card-text">Status:
                {% if conta.status == 'AT' %}
                    Ativa
                {% else %}
                    Inativa
                {% endif %}
            </p>
            <a href="{% url 'conta_bancaria_update' conta.pk %}" class="btn btn-primary">Editar</a>
            <a href="{% url 'conta_bancaria_delete' conta.pk %}" class="btn btn-danger">Excluir</a>
            <a href="{% url 'conta_bancaria_list' %}" class="btn btn-secondary">Voltar</a>
        </div>
    </div>

    <!-- Gráfico de movimentações -->
    <h3 class="mt-5">Gráfico de Movimentações</h3>
    <canvas id="movimentacoesChart"></canvas>
    
    <h2 class="mt-4">Movimentações Relacionadas</h2>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Data</th>
                <th>Descrição</th>
                <th>Valor</th>
                <th>Tipo</th>
                <th>Situação</th>
            </tr>
        </thead>
        <tbody>
            {% for operacao in movimentacoes %}
                <tr>
                    <td>{{ operacao.data|date:"d/m/Y" }}</td>
                    {% if operacao.descricao == none %}
                    <td>-</td>
                    {% else %}
                    <td>{{ operacao.descricao }}</td>
                    {% endif %}
                    <td>R$ {{ operacao.valor }}</td>
                    <td>
                        {% if operacao.tipo_despesa %}
                        Saída
                        {% else %}
                        Entrada 
                        {% endif %}
                    </td>
                    <td>{{ operacao.situacao_formatado }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="4" class="text-center">Nenhuma movimentação encontrada</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Incluindo o Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Dados do gráfico
    const labels = {{ labels|safe }};
    const entradas = {{ entradas|safe }};
    const saidas = {{ saidas|safe }};

    const data = {
        labels: labels,
        datasets: [
            {
                label: 'Entradas',
                data: entradas,
                backgroundColor: 'rgba(75, 192, 192, 0.6)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            },
            {
                label: 'Saídas',
                data: saidas,
                backgroundColor: 'rgba(255, 99, 132, 0.6)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }
        ]
    };

    // Configurações do gráfico
    const config = {
        type: 'bar', // ou 'line', 'pie', etc.
        data: data,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    };

    // Inicializando o gráfico
    const movimentacoesChart = new Chart(
        document.getElementById('movimentacoesChart'),
        config
    );
</script>


{% endblock %}
